<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ò–≥—Ä—ã –Ω–∞ —Ä–∞–∑–≤–∏—Ç–∏–µ</title>
  <style>
    body { background: #fffcd6; font-family: 'Comic Sans MS', Arial, Helvetica, sans-serif; margin:0; padding:0;}
    #game { text-align: center; margin-top: 40px; }
    #topbar { display: flex; gap: 16px; justify-content: center; align-items: center; flex-wrap: wrap; margin-bottom: 20px; }
    #modeLabel { font-size: 22px; color: #7346c8; }
    select { font-size: 20px; padding: 8px 12px; border-radius: 10px; border: 1px solid #bbb; }
    #score { font-size: 38px; font-weight: bold; margin-bottom: 16px; color: #FF5733; text-shadow: 1px 2px 6px #fffcd6; }
    #letter, #math { font-size: 90px; font-weight: bold; margin-bottom: 16px; transition: color 0.3s; text-shadow: 3px 5px 12px #ffcabb, 1px 2px 6px #fffcd6; letter-spacing: 8px; min-height: 110px; }
    #prompt { font-size: 32px; color: #7346c8; margin-bottom: 8px; min-height: 40px; }
    #result { font-size: 34px; margin-top: 18px; min-height: 45px; transition: color 0.3s; }
    #controls { margin-top: 28px; display: flex; gap: 16px; justify-content: center; align-items: center; flex-wrap: wrap; }
    #outputBtn { background: #CB6632; }
    button { padding: 16px 36px; font-size: 26px; background: #ff93c2; border: none; border-radius: 20px; box-shadow: 2px 4px 8px #919191; cursor: pointer; font-weight: bold; color: #fff; transition: background 0.3s, color 0.3s; }
    button:hover { background: #33fff0; color: #333; }
    #answerWrap { display: none; gap: 10px; justify-content: center; align-items: center; margin-top: 10px; flex-wrap: wrap; }
    #answerInput { font-size: 28px; padding: 10px 14px; width: 120px; text-align: center; border-radius: 12px; border: 1px solid #bbb; outline: none; }
    #checkBtn { background: #81d36b; }
    #statistics { margin: 32px auto 0 auto; background: #f7e2f7; border-radius: 14px; box-shadow: 1px 2px 8px #d9bade; padding: 28px 34px 18px 34px; width: fit-content; font-size: 22px; }
    #statistics h3 { margin: 0 0 8px 0; color: #8833d1; }
    #statistics table { margin: 0 auto; font-size: 22px; }
    #statistics td, #statistics th { padding: 0 14px; }
    /* --- –ù–∞–π–¥–∏ –ø–∞—Ä—É --- */
    #memory-wrap {display:none;}
    #game-board {
      margin: 0 auto;
      margin-top: 18px;
      margin-bottom: 18px;
      padding: 20px 0;
      display: grid;
      gap: 6px;
      width: max-content;
      justify-content: center;
      background: #ffeefd;
      border-radius: 15px;
      box-shadow: 0 3px 14px #cabeb6;
    }
    .cell {
      background: #ff93c2;
      border-radius: 9px;
      box-shadow: 1px 1px 5px #d0a6b4;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: transparent;
      font-weight: bold;
      transition: background 0.2s, color 0.2s;
      user-select: none;
      position: relative;
    }
    .cell.open {
      color: #452848;
      background: #f5ffa6;
      box-shadow: 0 2px 10px #a7b6d0;
    }
    .cell.matched {
      color: transparent;
      background: #fffcd6;
      cursor: default;
      box-shadow: none;
      visibility: hidden;
    }
    #memory-info {
      margin-top: 10px;
      font-size: 22px;
      color: #615c9c;
      min-height: 26px;
    }
    #restart-btn {
      margin-top: 10px;
      font-size: 20px;
      padding: 8px 26px;
      border-radius: 13px;
      background: #689cff;
      color: #fff;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 1px 2px 10px #9ec4f7;
      transition: background 0.25s;
      display: inline-block;
    }
    #restart-btn:hover { background: #33fff0; color: #333; }
    /* –°–ª–æ–≤–∞ */
    #word-wrap {display:none; margin-top:24px;}
    #wordBox {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 14px;
    }
    .word-letter {
      font-size: 52px;
      border-bottom: 2px dashed #aaa;
      min-width: 44px;
      padding: 0 6px;
      transition: background 0.2s, color 0.2s;
      background: #fff7ef;
      color: #87758e;
      border-radius: 8px;
      box-shadow: 1px 2px 5px #ede9fa;
      font-weight: bold;
    }
    .word-letter.done {
      background: #8fefa5;
      color: #345b37;
      border-bottom: 2px solid #56c578;
    }
    #timerBox { font-size: 36px; color:#b1422d; margin-bottom:8px;}
    #wordResult { font-size:34px; min-height:40px; margin-bottom:14px;}
    #nextWordBtn { background: #81d36b; font-size: 26px; border-radius:16px; padding:12px 26px; }
    #nextWordBtn:hover { background: #5acb85; color:#222; }
  </style>
</head>
<body>
  <div id="game">
    <div id="topbar">
      <span id="modeLabel">–†–µ–∂–∏–º:</span>
      <select id="mode">
        <option value="lettersRu">–†—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã</option>
        <option value="lettersEn">–ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã</option>
        <option value="math10">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (0‚Äì10)</option>
        <option value="math20">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (11‚Äì20)</option>
        <option value="math30">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (21‚Äì30)</option>
        <option value="memory4">–ù–∞–π–¥–∏ –ø–∞—Ä—É 4√ó4</option>
        <option value="memory6">–ù–∞–π–¥–∏ –ø–∞—Ä—É 6√ó6</option>
        <option value="memory8">–ù–∞–π–¥–∏ –ø–∞—Ä—É 8√ó8</option>
        <option value="word6ru">–†—É—Å—Å–∫–∏–µ —Å–ª–æ–≤–∞ (6 –±—É–∫–≤)</option>
        <option value="word7ru">–†—É—Å—Å–∫–∏–µ —Å–ª–æ–≤–∞ (7 –±—É–∫–≤)</option>
        <option value="word8ru">–†—É—Å—Å–∫–∏–µ —Å–ª–æ–≤–∞ (8 –±—É–∫–≤)</option>
        <option value="word6en">–ê–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–ª–æ–≤–∞ (6 –±—É–∫–≤)</option>
        <option value="word7en">–ê–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–ª–æ–≤–∞ (7 –±—É–∫–≤)</option>
        <option value="word8en">–ê–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–ª–æ–≤–∞ (8 –±—É–∫–≤)</option>
      </select>
    </div>
    <div id="score">–°—á–µ—Ç: 0.00 —Ä—É–±.</div>
    <h1 id="letter"></h1>
    <h1 id="math" style="display:none;"></h1>
    <p id="prompt">–ù–∞–∂–º–∏ —ç—Ç—É –±—É–∫–≤—É –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ!</p>
    <div id="answerWrap">
      <input id="answerInput" type="text" inputmode="numeric" autocomplete="off" placeholder="–û—Ç–≤–µ—Ç">
      <button id="checkBtn">–ü–†–û–í–ï–†–ò–¢–¨</button>
    </div>
    <div id="result"></div>
    <div id="controls">
      <button id="nextBtn">–°–õ–ï–î–£–Æ–©–ê–Ø</button>
      <button id="outputBtn">–í–´–í–ï–°–¢–ò –î–ï–ù–¨–ì–ò</button>
    </div>
    <div id="statistics"></div>
    <!-- –ù–∞–π–¥–∏ –ø–∞—Ä—É -->
    <div id="memory-wrap" style="display:none;">
      <div id="memory-info">–û—Ç–∫—Ä–æ–π—Ç–µ –¥–≤–∞ –∫–≤–∞–¥—Ä–∞—Ç–∞ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º —á–∏—Å–ª–æ–º!</div>
      <div id="game-board"></div>
      <button id="restart-btn">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    </div>
    <!-- –°–ª–æ–≤–∞ -->
    <div id="word-wrap" style="display:none;">
      <div id="timerBox"></div>
      <div id="wordBox"></div>
      <div id="wordResult"></div>
      <button id="nextWordBtn" style="display:none;">–°–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ</button>
    </div>
  </div>
  <script>
    // == –î–æ–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞—Ä–∏ ==
    const wordListRu6=["–ü–û–ï–ó–î–´","–¢–ê–ë–õ–û–ö","–°–û–°–ù–´–ô","–ö–ê–†–¢–ò–ù","–ê–†–ë–£–ó–´","–°–¢–û–õ–ò–ö","–ú–ê–õ–ò–ù–ê","–í–ï–†–•–û–ú","–°–ï–†–î–¶–ï","–ì–†–£–ü–ü–ê","–°–¢–û–õ–ò–ö","–õ–ò–ú–û–ù–´","–ö–û–®–ï–õ–¨"];
    const wordListRu7=["–ö–ê–†–ê–ú–ï–õ","–°–ê–ü–û–ì–ò–ß","–í–ï–ù–¢–ò–õ–¨","–õ–ê–ú–ü–û–ß–ö","–ö–û–†–û–í–ê–ú","–ü–ò–†–ê–¢–´","–ú–û–†–ö–û–í–ö","–ñ–£–†–ù–ê–õ–´","–û–ö–ï–ê–ù–´","–ü–ò–û–ù–ï–†–´","–®–ö–û–õ–¨–ù–ò"];
    const wordListRu8=["–ü–ï–†–ï–õ–ï–¢–´","–°–ï–ö–†–ï–¢–´–ò","–†–ê–î–ò–ê–¢–û–†","–õ–ê–ú–ò–ù–ê–¢–´","–ü–†–û–í–û–î–ö–ê","–ú–ê–ì–ê–ó–ò–ù–´","–§–ï–í–†–ê–õ–¨","–ö–ê–ù–ò–°–¢–†–ê","–ö–£–õ–¨–¢–£–†–ê","–ö–í–ê–î–†–ê–¢–´"];
    const wordListEn6=["MONKEY","TABLET","SAFETY","WINDOW","FORMAL","SUBWAY","POCKET","BUTTON","BALLET","SILENT","BOTTLE"];
    const wordListEn7=["CAPTAIN","MONSTER","STATION","SUBJECT","SECTION","PROJECT","PRESENT","FIREMAN","BISCUIT","VIOLETS","STUDENT"];
    const wordListEn8=["OPERATOR","SOLUTION","ELEVATOR","ACTIVATE","CONTRACT","DIALOGUE","BASEMENT","MEDICINE","JOURNALY","SUNSHINE"];
    // == –û—Å—Ç–∞–ª—å–Ω–æ–µ –∫–∞–∫ —Ä–∞–Ω—å—à–µ ==
    const lettersRu = [ '–ê','–ë','–í','–ì','–î','–ï','–Å','–ñ','–ó','–ò','–ô','–ö','–õ','–ú','–ù','–û','–ü','–†','–°','–¢','–£','–§','–•','–¶','–ß','–®','–©','–™','–´','–¨','–≠','–Æ','–Ø' ];
    const lettersEn = [ 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z' ];
    const rewards = {
      lettersRu: 0.25, lettersEn: 0.30, math10: 0.5, math20: 0.75, math30: 1.0,
      memory4: 0.5, memory6: 0.75, memory8: 1.0,
      word6ru: 2.0, word7ru: 2.0, word8ru: 2.0,
      word6en: 2.0, word7en: 2.0, word8en: 2.0
    };
    let stats = { balance: 0, lettersFoundRu: 0, lettersFoundEn: 0, math: { math10: 0, math20: 0, math30: 0 } };
    let memoryStats = { memory4: 0, memory6: 0, memory8: 0 };
    let wordStats = { word6ru: 0, word7ru: 0, word8ru: 0, word6en: 0, word7en: 0, word8en: 0 };
    let letterAnswered = false, mathAnswered = false, mode = "lettersRu";
    let currentWord="", wordLetters=[], currIdx=0, wordTimer=null, timeLeft=0, wordAnswered=false, prevWord="";
    const modeSel = document.getElementById('mode'), scoreDiv = document.getElementById('score'), letterH1 = document.getElementById('letter'), mathH1 = document.getElementById('math'), promptP = document.getElementById('prompt'), resultDiv = document.getElementById('result'), nextBtn = document.getElementById('nextBtn'), outputBtn = document.getElementById('outputBtn'), answerWrap = document.getElementById('answerWrap'), answerInput = document.getElementById('answerInput'), checkBtn = document.getElementById('checkBtn'), statisticsDiv = document.getElementById('statistics'), memoryWrap = document.getElementById('memory-wrap'), wordWrap = document.getElementById('word-wrap'), wordBox = document.getElementById('wordBox'), wordResult = document.getElementById('wordResult'), nextWordBtn = document.getElementById('nextWordBtn'), timerBox = document.getElementById('timerBox');
    const rand = (min,max) => Math.floor(Math.random()*(max-min+1))+min;
    function updateScore(){scoreDiv.innerText=`–°—á–µ—Ç: ${stats.balance.toFixed(2)} —Ä—É–±.`;}
    function updateStatsTable(){
      statisticsDiv.innerHTML = `<h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
      <table>
        <tr><td>–†—É—Å—Å–∫–∏—Ö –±—É–∫–≤ –Ω–∞–π–¥–µ–Ω–æ:</td><td><b>${stats.lettersFoundRu}</b></td></tr>
        <tr><td>–ê–Ω–≥–ª–∏–π—Å–∫–∏—Ö –±—É–∫–≤ –Ω–∞–π–¥–µ–Ω–æ:</td><td><b>${stats.lettersFoundEn}</b></td></tr>
        <tr><th colspan="2" style="padding:8px 0 4px 0; color:#8B5CD0;">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</th></tr>
        <tr><td>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (0‚Äì10):</td><td><b>${stats.math.math10}</b></td></tr>
        <tr><td>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (11‚Äì20):</td><td><b>${stats.math.math20}</b></td></tr>
        <tr><td>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (21‚Äì30):</td><td><b>${stats.math.math30}</b></td></tr>
        <tr><th colspan="2" style="padding:8px 0 4px 0; color:#b567bb;">–ù–∞–π–¥–∏ –ø–∞—Ä—É</th></tr>
        <tr><td>–ü–∞—Ä—ã (4√ó4):</td><td><b>${memoryStats.memory4}</b></td></tr>
        <tr><td>–ü–∞—Ä—ã (6√ó6):</td><td><b>${memoryStats.memory6}</b></td></tr>
        <tr><td>–ü–∞—Ä—ã (8√ó8):</td><td><b>${memoryStats.memory8}</b></td></tr>
        <tr><th colspan="2" style="padding:8px 0 4px 0; color:#4e8cbb;">–†—É—Å—Å–∫–∏–µ —Å–ª–æ–≤–∞</th></tr>
        <tr><td>–°–ª–æ–≤ (6 –±—É–∫–≤):</td><td><b>${wordStats.word6ru}</b></td></tr>
        <tr><td>–°–ª–æ–≤ (7 –±—É–∫–≤):</td><td><b>${wordStats.word7ru}</b></td></tr>
        <tr><td>–°–ª–æ–≤ (8 –±—É–∫–≤):</td><td><b>${wordStats.word8ru}</b></td></tr>
        <tr><th colspan="2" style="padding:8px 0 4px 0; color:#2278bb;">–ê–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–ª–æ–≤–∞</th></tr>
        <tr><td>Words (6 letters):</td><td><b>${wordStats.word6en}</b></td></tr>
        <tr><td>Words (7 letters):</td><td><b>${wordStats.word7en}</b></td></tr>
        <tr><td>Words (8 letters):</td><td><b>${wordStats.word8en}</b></td></tr>
      </table>
      <div style="margin-top:10px;color:#CB6632;">–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <b>${stats.balance.toFixed(2)}</b> —Ä—É–±.</div>`;
    }
    function saveStats(){localStorage.setItem('mathletters_stats',JSON.stringify(stats));}
    function saveMemoryStats(){localStorage.setItem('mathletters_memstats',JSON.stringify(memoryStats));}
    function saveWordStats(){localStorage.setItem('mathletters_wordstats',JSON.stringify(wordStats));}
    function loadAllStats(){try{let s=localStorage.getItem('mathletters_stats');if(s){let o=JSON.parse(s);Object.assign(stats,o);}
      s=localStorage.getItem('mathletters_memstats');if(s){let o=JSON.parse(s);Object.assign(memoryStats,o);}
      s=localStorage.getItem('mathletters_wordstats');if(s){let o=JSON.parse(s);Object.assign(wordStats,o);}}catch{}}
    function showBlocks(arr){arr.forEach(id=>{const e=document.getElementById(id);if(e)e.style.display='';});}
    function hideBlocks(arr){arr.forEach(id=>{const e=document.getElementById(id);if(e)e.style.display='none';});}
    function switchToLettersRu(){
      showBlocks(["letter","score","topbar","prompt","result","controls","statistics"]);
      hideBlocks(["math","answerWrap","memory-wrap","word-wrap"]);
      letterH1.innerText = lettersRu[rand(0,lettersRu.length-1)];
      letterH1.style.color = "#3399ff";
      promptP.innerText = '–ù–∞–∂–º–∏ —ç—Ç—É –±—É–∫–≤—É –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ!';
      resultDiv.innerHTML = ''; letterAnswered = false;
    }
    function switchToLettersEn(){
      showBlocks(["letter","score","topbar","prompt","result","controls","statistics"]);
      hideBlocks(["math","answerWrap","memory-wrap","word-wrap"]);
      letterH1.innerText = lettersEn[rand(0,lettersEn.length-1)];
      letterH1.style.color = "#3399ff";
      promptP.innerText = 'Press this letter on the keyboard!';
      resultDiv.innerHTML = ''; letterAnswered = false;
    }
    function switchToMath(){
      showBlocks(["math","score","topbar","prompt","result","controls","statistics","answerWrap"]);
      hideBlocks(["letter","memory-wrap","word-wrap"]);
      generateMathTask();
    }
    function switchToMemory(mMode){
      hideBlocks(["letter","math","answerWrap","prompt","result","controls","word-wrap","statistics"]);
      document.getElementById('memory-wrap').style.display='block';
      startMemoryGame(mMode);
    }
    function switchToWord(modeKey){
      hideBlocks(["letter","math","answerWrap","prompt","result","controls","statistics","memory-wrap"]);
      wordWrap.style.display='block';
      startWordGame(modeKey);
    }
    function generateMathTask(){let min,max;
      if(mode==="math10"){min=0;max=10;}
      if(mode==="math20"){min=11;max=20;}
      if(mode==="math30"){min=21;max=30;}
      op=Math.random()<0.5?'+':'-';
      if(op==='+'){let sum=rand(min,max);let a1=rand(min,sum);let b1=sum-a1;a=a1;b=b1;answer=sum;}
      else{a=rand(min,max);b=rand(min,a);answer=a-b;}
      mathH1.innerText=`${a} ${op==='+'?'+':'‚àí'} ${b} = ?`;
      resultDiv.innerHTML=''; answerInput.value=''; mathAnswered=false; setTimeout(()=>answerInput.focus(),0);
    }
    checkBtn.onclick=checkMathAnswer;
    function checkMathAnswer(){if(mathAnswered)return;
      let raw=answerInput.value.trim(),num=Number(raw);
      if(!Number.isInteger(num)){resultDiv.innerHTML='–í–≤–µ–¥–∏ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ!';resultDiv.style.color="#FF5733";return;}
      if(num===answer){stats.balance=+(stats.balance+rewards[mode]).toFixed(2);stats.math[mode]=(stats.math[mode]||0)+1;mathAnswered=true;saveStats();updateScore();updateStatsTable();resultDiv.innerHTML=`–ú–æ–ª–æ–¥–µ—Ü! <span style="color:#3399FF;">+${rewards[mode]} —Ä—É–±.</span> ‚ú®üòçüëç`;resultDiv.style.color="#33FF57";setTimeout(()=>generateMathTask(),700);}
      else{resultDiv.innerHTML=`–û–π! –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–µ ${num}. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë!`;resultDiv.style.color="#FF5733";}
    }
    answerInput.onkeydown=function(e){if(mathAnswered)return e.preventDefault();const allowed=['Backspace','Delete','ArrowLeft','ArrowRight','Tab','Enter'];
      if(allowed.includes(e.key)){if(e.key==='Enter'){e.preventDefault();checkMathAnswer();}return;}if(e.key>='0'&&e.key<='9'){if(answerInput.value.length>=2)return e.preventDefault();}e.preventDefault();};
    document.onkeydown=function(e){if(modeSel.value==="lettersRu"||modeSel.value==="lettersEn"){if(letterAnswered)return;
      let pressed=e.key.toUpperCase(),target=letterH1.innerText;
      if(modeSel.value==="lettersRu"){if(pressed===target){stats.balance=+(stats.balance+rewards.lettersRu).toFixed(2);stats.lettersFoundRu++;letterAnswered=true;saveStats();updateScore();updateStatsTable();resultDiv.innerHTML=`–ú–æ–ª–æ–¥–µ—Ü! <span style="color:#3399FF;">+${rewards.lettersRu} —Ä—É–±.</span> ‚ú®üòçüëç`;resultDiv.style.color="#33FF57";setTimeout(nextItem,800);}
      else if(lettersRu.includes(pressed)){resultDiv.innerHTML=`–û–π! –≠—Ç–æ –Ω–µ "${target}".`;resultDiv.style.color="#FF5733";}}
      else{if(pressed===target){stats.balance=+(stats.balance+rewards.lettersEn).toFixed(2);stats.lettersFoundEn++;letterAnswered=true;saveStats();updateScore();updateStatsTable();resultDiv.innerHTML=`Good job! <span style="color:#3399FF;">+${rewards.lettersEn} —Ä—É–±.</span> ‚ú®üòçüëç`;resultDiv.style.color="#33FF57";setTimeout(nextItem,800);}
      else if(lettersEn.includes(pressed)){resultDiv.innerHTML=`Oops! It's not "${target}".`;resultDiv.style.color="#FF5733";}}}
      else if(modeSel.value.startsWith('word')){if(wordAnswered||currIdx>=wordLetters.length)return;let pressed=e.key.toUpperCase(),letter=wordLetters[currIdx];if(/[–ê-–Ø–Å]/.test(letter)&&pressed===letter){wordBox.children[currIdx].classList.add('done');currIdx++;if(currIdx>=wordLetters.length)winWord();}
      else if(/[A-Z]/.test(letter)&&pressed===letter){wordBox.children[currIdx].classList.add('done');currIdx++;if(currIdx>=wordLetters.length)winWord();}}
    };
    function nextItem(){if(mode==="lettersRu"){switchToLettersRu();}
      else if(mode==="lettersEn"){switchToLettersEn();}
      else{generateMathTask();}}
    nextBtn.onclick=nextItem;
    outputBtn.onclick=function(){
      if(stats.balance>0){let oldB=stats.balance.toFixed(2);stats.balance=0;saveStats();updateScore();updateStatsTable();alert(`–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!\n\n–¢—ã –≤—ã–≤–µ–ª ${oldB} —Ä—É–±.\n–¢–µ–ø–µ—Ä—å –º–æ–∂–µ—à—å –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –∏—Ö –∫–∞–∫ –∑–∞—Ö–æ—á–µ—à—å!`);}
      else alert('–ü–æ–∫–∞ –Ω–µ—á–µ–≥–æ –≤—ã–≤–æ–¥–∏—Ç—å!\n–ó–∞—Ä–∞–±–æ—Ç–∞–π –µ—â–µ üòâ');
    };
    // ====== –ù–∞–π–¥–∏ –ø–∞—Ä—É ======
    let board=[],opened=[],matchedCount=0,locked=false,currentMemoryMode="memory4";
    const boardDiv=document.getElementById('game-board'),memoryInfoDiv=document.getElementById('memory-info'),restartBtn=document.getElementById('restart-btn');
    function getBoardConf(mMode){if(mMode==="memory4")return{size:4,pairs:8};if(mMode==="memory6")return{size:6,pairs:18};return{size:8,pairs:32};}
    function shuffle(array){for(let i=array.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];}return array;}
    function newBoard(mMode){let conf=getBoardConf(mMode);board=[];opened=[];matchedCount=0;locked=false;let nums=[];for(let n=1;n<=conf.pairs;n++){nums.push(n);nums.push(n);}shuffle(nums);for(let i=0;i<conf.size*conf.size;i++){board.push({num:nums[i],open:false,matched:false});}}
    function renderBoard(mMode){let conf=getBoardConf(mMode);boardDiv.innerHTML='';boardDiv.style.gridTemplateColumns=`repeat(${conf.size},48px)`;boardDiv.style.gridTemplateRows=`repeat(${conf.size},48px)`;board.forEach((cell,idx)=>{let div=document.createElement('div');div.className='cell';div.style.width="46px";div.style.height="46px";if(cell.open)div.classList.add('open');if(cell.matched)div.classList.add('matched');div.textContent=cell.open||cell.matched?cell.num:'';div.onclick=()=>cellClicked(idx,mMode);boardDiv.appendChild(div);});}
    function cellClicked(idx,mMode){if(locked||board[idx].matched||board[idx].open||opened.length>=2)return;board[idx].open=true;opened.push(idx);renderBoard(mMode);if(opened.length===2){locked=true;let a=board[opened[0]].num,b=board[opened[1]].num;if(a===b){setTimeout(()=>{board[opened[0]].matched=true;board[opened[1]].matched=true;matchedCount++;stats.balance=+(stats.balance+rewards[mMode]).toFixed(2);memoryStats[mMode]+=1;saveStats();saveMemoryStats();updateScore();updateStatsTable();opened=[];locked=false;renderBoard(mMode);let conf=getBoardConf(mMode);if(matchedCount===conf.pairs){memoryInfoDiv.textContent="–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—Å–µ –ø–∞—Ä—ã –Ω–∞–π–¥–µ–Ω—ã üéâ";restartBtn.style.display='';}},500);}else{setTimeout(()=>{board[opened[0]].open=false;board[opened[1]].open=false;opened=[];locked=false;renderBoard(mMode);},800);}}}
    function startMemoryGame(mMode){currentMemoryMode=mMode;newBoard(mMode);renderBoard(mMode);memoryInfoDiv.textContent="–û—Ç–∫—Ä–æ–π—Ç–µ –¥–≤–∞ –∫–≤–∞–¥—Ä–∞—Ç–∞ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º —á–∏—Å–ª–æ–º!";restartBtn.style.display='none';}
    restartBtn.onclick=function(){startMemoryGame(currentMemoryMode);};
    // === –ù–æ–≤—ã–π WORD GAME ===
    function startWordGame(modeKey){
      let pool = [], len = 6;
      if(modeKey==="word6ru"){pool=wordListRu6;len=6;}else if(modeKey==="word7ru"){pool=wordListRu7;len=7;}
      else if(modeKey==="word8ru"){pool=wordListRu8;len=8;}else if(modeKey==="word6en"){pool=wordListEn6;len=6;}
      else if(modeKey==="word7en"){pool=wordListEn7;len=7;}else if(modeKey==="word8en"){pool=wordListEn8;len=8;}
      currIdx=0;wordAnswered=false;wordResult.innerHTML='';nextWordBtn.style.display='none';clearInterval(wordTimer);
      let candidateList=pool.filter(w=>w!==prevWord);
      if(candidateList.length===0){candidateList=pool;}
      currentWord=candidateList[rand(0,candidateList.length-1)].toUpperCase();
      prevWord=currentWord;
      wordBox.innerHTML='';wordLetters=currentWord.split('');
      for(let l=0;l<wordLetters.length;l++){let span=document.createElement('span');span.className='word-letter';span.textContent=wordLetters[l];wordBox.appendChild(span);}
      timeLeft = len*2; timerBox.textContent=`‚è± –û—Å—Ç–∞–ª–æ—Å—å: ${timeLeft} —Å–µ–∫`;
      wordTimer=setInterval(()=>{timeLeft--;timerBox.textContent=`‚è± –û—Å—Ç–∞–ª–æ—Å—å: ${timeLeft} —Å–µ–∫`;if(timeLeft<=0)loseWord();},1000);
    }
    function winWord(){
      if(wordAnswered)return;clearInterval(wordTimer);wordAnswered=true;
      wordResult.innerHTML=`–£—Å–ø–µ—Ö! <span style='color:#3399FF;'>+${rewards[mode]} —Ä—É–±.</span> üéâ`;
      stats.balance=+(stats.balance+rewards[mode]).toFixed(2);wordStats[mode]+=1;
      saveStats();saveWordStats();updateScore();updateStatsTable();nextWordBtn.style.display='';
    }
    function loseWord(){
      if(wordAnswered)return;clearInterval(wordTimer);wordAnswered=true;wordResult.innerHTML="–í—Ä–µ–º—è –≤—ã—à–ª–æ! –ü–æ–ø—Ä–æ–±—É–π —Å–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ.";nextWordBtn.style.display='';
    }
    nextWordBtn.onclick=function(){startWordGame(mode);};
    // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
    loadAllStats();
    updateScore();
    updateStatsTable();
    switchToLettersRu();
    modeSel.onchange=function(){
      mode=modeSel.value;
      if(mode==="lettersRu"){switchToLettersRu();}
      else if(mode==="lettersEn"){switchToLettersEn();}
      else if(["math10","math20","math30"].includes(mode)){switchToMath();}
      else if(mode.startsWith("word")){switchToWord(mode);}
      else{switchToMemory(mode);}
    };
    wordWrap.style.display='none';
    memoryWrap.style.display='none';
    mathH1.style.display='none';
    answerWrap.style.display='none';
  </script>
</body>
</html>
