<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Учимся и развиваемся!</title>
  <style>
    body { background: #fffcd6; font-family: 'Comic Sans MS', Arial, Helvetica, sans-serif; margin:0; padding:0;}
    #game { text-align: center; margin-top: 40px; }
    #topbar { display: flex; gap: 16px; justify-content: center; align-items: center; flex-wrap: wrap; margin-bottom: 20px; }
    #modeLabel { font-size: 22px; color: #7346c8; }
    select { font-size: 20px; padding: 8px 12px; border-radius: 10px; border: 1px solid #bbb; }
    #score { font-size: 38px; font-weight: bold; margin-bottom: 16px; color: #FF5733; text-shadow: 1px 2px 6px #fffcd6; }
    #letter, #math { font-size: 90px; font-weight: bold; margin-bottom: 16px; transition: color 0.3s; text-shadow: 3px 5px 12px #ffcabb, 1px 2px 6px #fffcd6; letter-spacing: 8px; min-height: 110px; }
    #prompt { font-size: 32px; color: #7346c8; margin-bottom: 8px; min-height: 40px; }
    #result { font-size: 34px; margin-top: 18px; min-height: 45px; transition: color 0.3s; }
    #controls { margin-top: 28px; display: flex; gap: 16px; justify-content: center; align-items: center; flex-wrap: wrap; }
    #outputBtn { background: #CB6632; }
    button { padding: 16px 36px; font-size: 26px; background: #ff93c2; border: none; border-radius: 20px; box-shadow: 2px 4px 8px #919191; cursor: pointer; font-weight: bold; color: #fff; transition: background 0.3s, color 0.3s; }
    button:hover { background: #33fff0; color: #333; }
    #answerWrap { display: none; gap: 10px; justify-content: center; align-items: center; margin-top: 10px; flex-wrap: wrap; }
    #answerInput { font-size: 28px; padding: 10px 14px; width: 120px; text-align: center; border-radius: 12px; border: 1px solid #bbb; outline: none; }
    #checkBtn { background: #81d36b; }
    #statistics { margin: 32px auto 0 auto; background: #f7e2f7; border-radius: 14px; box-shadow: 1px 2px 8px #d9bade; padding: 28px 34px 18px 34px; width: fit-content; font-size: 22px; }
    #statistics h3 { margin: 0 0 8px 0; color: #8833d1; }
    #statistics table { margin: 0 auto; font-size: 22px; }
    #statistics td, #statistics th { padding: 0 14px; }
    /* --- Найди пару --- */
    #memory-wrap {display:none;}
    #game-board {
      margin: 0 auto;
      margin-top: 18px;
      margin-bottom: 18px;
      padding: 20px 0;
      display: grid;
      grid-template-columns: repeat(10, 48px);
      grid-template-rows: repeat(10, 48px);
      gap: 6px;
      width: max-content;
      justify-content: center;
      background: #ffeefd;
      border-radius: 15px;
      box-shadow: 0 3px 14px #cabeb6;
    }
    .cell {
      width: 46px;
      height: 46px;
      background: #ff93c2;
      border-radius: 9px;
      box-shadow: 1px 1px 5px #d0a6b4;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: transparent;
      font-weight: bold;
      transition: background 0.2s, color 0.2s;
      user-select: none;
      position: relative;
    }
    .cell.open {
      color: #452848;
      background: #f5ffa6;
      box-shadow: 0 2px 10px #a7b6d0;
    }
    .cell.matched {
      color: transparent;
      background: #fffcd6;
      cursor: default;
      box-shadow: none;
      visibility: hidden;
    }
    #memory-info {
      margin-top: 10px;
      font-size: 22px;
      color: #615c9c;
      min-height: 26px;
    }
    #restart-btn {
      margin-top: 10px;
      font-size: 20px;
      padding: 8px 26px;
      border-radius: 13px;
      background: #689cff;
      color: #fff;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 1px 2px 10px #9ec4f7;
      transition: background 0.25s;
      display: inline-block;
    }
    #restart-btn:hover { background: #33fff0; color: #333; }
    @media (max-width:650px) {
      #game-board {grid-template-columns: repeat(5, 9vw);grid-template-rows: repeat(20, 9vw);}
      .cell{width:8vw; height:8vw; font-size:4vw;}
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="topbar">
      <span id="modeLabel">Режим:</span>
      <select id="mode">
        <option value="letters">Буквы</option>
        <option value="math10">Математика (0–10)</option>
        <option value="math20">Математика (11–20)</option>
        <option value="math30">Математика (21–30)</option>
        <option value="memory">Найди пару</option>
      </select>
    </div>
    <div id="score">Счет: 0.00 руб.</div>
    <h1 id="letter"></h1>
    <h1 id="math" style="display:none;"></h1>
    <p id="prompt">Нажми эту букву на клавиатуре!</p>
    <div id="answerWrap">
      <input id="answerInput" type="text" inputmode="numeric" autocomplete="off" placeholder="Ответ">
      <button id="checkBtn">ПРОВЕРИТЬ</button>
    </div>
    <div id="result"></div>
    <div id="controls">
      <button id="nextBtn">СЛЕДУЮЩАЯ</button>
      <button id="outputBtn">ВЫВЕСТИ ДЕНЬГИ</button>
    </div>
    <div id="statistics"></div>
    <!-- Найди пару -->
    <div id="memory-wrap" style="display:none;">
      <div id="memory-info">Откройте два квадрата с одинаковым числом!</div>
      <div id="game-board"></div>
      <button id="restart-btn">Начать заново</button>
    </div>
  </div>
  <script>
    // Остальные режимы (буквы, математика) — как раньше
    const letters = [
      'А','Б','В','Г','Д','Е','Ё','Ж','З','И','Й','К','Л','М','Н','О','П','Р',
      'С','Т','У','Ф','Х','Ц','Ч','Ш','Щ','Ъ','Ы','Ь','Э','Ю','Я'
    ];
    const colors = ["#FF5733", "#33FF57", "#3399FF", "#FBD400", "#FF33A1", "#B833FF", "#33FFF6", "#FF9966",
      "#81FF33", "#FFB533", "#33FFB5", "#FF3383", "#33CFFF", "#9D33FF", "#FFC300", "#FF5733",
      "#8DFF33", "#FF3380", "#338CFF", "#A133FF"
    ];
    const rewards = {
      letters: 0.25,
      math10: 0.5,
      math20: 0.75,
      math30: 1.0
    };
    let stats = {
      balance: 0,
      lettersFound: 0,
      math: { math10: 0, math20: 0, math30: 0 }
    };
    let mode = 'letters';
    const modeSel = document.getElementById('mode');
    const scoreDiv = document.getElementById('score');
    const letterH1 = document.getElementById('letter');
    const mathH1 = document.getElementById('math');
    const promptP = document.getElementById('prompt');
    const resultDiv = document.getElementById('result');
    const nextBtn = document.getElementById('nextBtn');
    const outputBtn = document.getElementById('outputBtn');
    const answerWrap = document.getElementById('answerWrap');
    const answerInput = document.getElementById('answerInput');
    const checkBtn = document.getElementById('checkBtn');
    const statisticsDiv = document.getElementById('statistics');
    const memoryWrap = document.getElementById('memory-wrap');

    function getSavedStats() {
      const s = localStorage.getItem('mathletters_stats');
      if (s) {
        try {
          const parsed = JSON.parse(s);
          if (parsed && typeof parsed === "object") return {...stats, ...parsed, math: { ...stats.math, ...parsed.math }};
        } catch {}
      }
      return stats;
    }
    function saveStats() { localStorage.setItem('mathletters_stats', JSON.stringify(stats)); }
    const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const getRandomLetter = () => letters[Math.floor(Math.random() * letters.length)];
    const getRandomColor = () => colors[Math.floor(Math.random() * colors.length)];
    function updateScore() { scoreDiv.innerText = `Счет: ${stats.balance.toFixed(2)} руб.`;}
    function updateStatsTable() {
      statisticsDiv.innerHTML = `<h3>Статистика</h3>
        <table>
          <tr><td>Всего найдено букв:</td><td><b>${stats.lettersFound}</b></td></tr>
          <tr><th colspan="2" style="padding:8px 0 4px 0; color:#8B5CD0;">Математика</th></tr>
          <tr><td>Правильных ответов (0–10):</td><td><b>${stats.math.math10}</b></td></tr>
          <tr><td>Правильных ответов (11–20):</td><td><b>${stats.math.math20}</b></td></tr>
          <tr><td>Правильных ответов (21–30):</td><td><b>${stats.math.math30}</b></td></tr>
        </table>
        <div style="margin-top:10px;color:#CB6632;">Всего заработано: <b>${stats.balance.toFixed(2)}</b> руб.</div>`;
    }
    function generateMathTask() {
      let min, max;
      if (mode === "math10") { min = 0;  max = 10; }
      if (mode === "math20") { min = 11; max = 20; }
      if (mode === "math30") { min = 21; max = 30; }
      op = Math.random() < 0.5 ? '+' : '-';
      if (op === '+') {
        let sum = rand(min, max);
        let a_tmp = rand(min, sum);
        let b_tmp = sum - a_tmp;
        a = a_tmp; b = b_tmp; answer = sum;
      } else {
        a = rand(min, max);
        b = rand(min, a);
        answer = a - b;
      }
      mathH1.innerText = `${a} ${op === '+' ? '+' : '−'} ${b} = ?`;
      mathH1.style.color = getRandomColor();
      resultDiv.innerHTML = '';
      answerInput.value = '';
      setTimeout(() => answerInput.focus(), 0);
    }
    let currentLetter = null, a = 0, b = 0, op = '+', answer = 0;

    function switchToLetters() {
      letterH1.style.display = '';
      mathH1.style.display = 'none';
      answerWrap.style.display = 'none';
      promptP.style.display = '';
      resultDiv.style.display = '';
      nextBtn.style.display = '';
      outputBtn.style.display = '';
      statisticsDiv.style.display = '';
      memoryWrap.style.display = 'none';
      letterH1.innerText = getRandomLetter();
      letterH1.style.color = getRandomColor();
      promptP.innerText = 'Нажми эту букву на клавиатуре!';
      resultDiv.innerHTML = '';
      answerInput.blur();
    }
    function switchToMath() {
      letterH1.style.display = 'none';
      mathH1.style.display = '';
      answerWrap.style.display = 'flex';
      promptP.style.display = '';
      resultDiv.style.display = '';
      nextBtn.style.display = '';
      outputBtn.style.display = '';
      statisticsDiv.style.display = '';
      memoryWrap.style.display = 'none';
      promptP.innerText = 'Реши пример и введи ответ:';
      generateMathTask();
    }
    function switchToMemory() {
      letterH1.style.display = 'none';
      mathH1.style.display = 'none';
      answerWrap.style.display = 'none';
      promptP.style.display = 'none';
      resultDiv.style.display = 'none';
      nextBtn.style.display = 'none';
      outputBtn.style.display = 'none';
      statisticsDiv.style.display = 'none';
      memoryWrap.style.display = 'block';
      startMemoryGame();
    }
    function checkMathAnswer() {
      const raw = answerInput.value.trim();
      const num = Number(raw);
      if (!Number.isInteger(num)) {
        resultDiv.innerHTML = `Введи целое число!`;
        resultDiv.style.color = "#FF5733";
        return;
      }
      if (num === answer) {
        stats.balance = +(stats.balance + rewards[mode]).toFixed(2);
        stats.math[mode] = (stats.math[mode] || 0) + 1;
        saveStats();
        updateScore();
        updateStatsTable();
        resultDiv.innerHTML = `Молодец! <span style="color:#3399FF;">+${rewards[mode]} руб.</span> ✨😍👍`;
        resultDiv.style.color = "#33FF57";
        setTimeout(() => { generateMathTask(); }, 700);
      } else {
        resultDiv.innerHTML = `Ой! Правильный ответ не ${num}. Попробуй ещё!`;
        resultDiv.style.color = "#FF5733";
      }
    }
    checkBtn.addEventListener('click', checkMathAnswer);
    answerInput.addEventListener('keydown', (e) => {
      const allowedKeys = ['Backspace','Delete','ArrowLeft','ArrowRight','Tab','Enter'];
      if (allowedKeys.includes(e.key)) {
        if (e.key === 'Enter') { e.preventDefault(); checkMathAnswer(); }
        return;
      }
      if (e.key >= '0' && e.key <= '9') {
        const sel = answerInput.selectionStart !== answerInput.selectionEnd;
        if (answerInput.value.length >= 2 && !sel) e.preventDefault();
        return;
      }
      e.preventDefault();
    });
    document.addEventListener('keydown', function(e) {
      if (modeSel.value !== 'letters') return;
      let pressed = e.key.toUpperCase();
      let target = letterH1.innerText;
      if (pressed === target) {
        stats.balance = +(stats.balance + rewards.letters).toFixed(2);
        stats.lettersFound += 1;
        saveStats();
        updateScore();
        updateStatsTable();
        resultDiv.innerHTML = `Молодец! <span style="color:#3399FF;">+${rewards.letters} руб.</span> ✨😍👍`;
        resultDiv.style.color = "#33FF57";
        setTimeout(nextItem, 800);
      } else if (letters.includes(pressed)) {
        resultDiv.innerHTML = `Ой! Это не "${target}".`;
        resultDiv.style.color = "#FF5733";
      }
    });
    function nextItem() {
      if (mode === 'letters') {
        letterH1.innerText = getRandomLetter();
        letterH1.style.color = getRandomColor();
        resultDiv.innerHTML = "";
      } else {
        generateMathTask();
      }
    }
    nextBtn.addEventListener('click', nextItem);
    outputBtn.addEventListener('click', () => {
      if (stats.balance > 0) {
        let oldBalance = stats.balance.toFixed(2);
        stats.balance = 0;
        saveStats();
        updateScore();
        updateStatsTable();
        alert(`Поздравляем!\n\nТы вывел ${oldBalance} руб.\nТеперь можешь потратить их как захочешь!`);
      } else {
        alert('Пока нечего выводить!\nЗаработай еще 😉');
      }
    });
    // Запуск и сохранение обычных режимов
    stats = getSavedStats();
    updateScore();
    updateStatsTable();
    if (mode === 'letters') switchToLetters();
    else switchToMath();

    modeSel.addEventListener('change', () => {
      mode = modeSel.value;
      if(mode==="letters")    { switchToLetters(); }
      else if(mode==="memory"){ switchToMemory(); }
      else                   { switchToMath(); }
    });

    // ====== НАЙДИ ПАРУ ======
    const boardSize = 10;
    const numPairs = 50;
    let board = [], opened = [], matchedCount = 0, locked = false;
    const boardDiv = document.getElementById('game-board');
    const memoryInfoDiv = document.getElementById('memory-info');
    const restartBtn = document.getElementById('restart-btn');
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    function newBoard() {
      board = []; opened = []; matchedCount = 0; locked = false;
      let nums = [];
      for (let n = 1; n <= numPairs; n++) { nums.push(n); nums.push(n); }
      shuffle(nums);
      for (let i = 0; i < boardSize * boardSize; i++) {
        board.push({num: nums[i], open: false, matched: false});
      }
    }
    function renderBoard() {
      boardDiv.innerHTML = '';
      board.forEach((cell, idx) => {
        let div = document.createElement('div');
        div.className = 'cell';
        if (cell.open) div.classList.add('open');
        if (cell.matched) div.classList.add('matched');
        div.textContent = cell.open || cell.matched ? cell.num : '';
        div.onclick = () => cellClicked(idx);
        boardDiv.appendChild(div);
      });
    }
    function cellClicked(idx) {
      if (locked || board[idx].matched || board[idx].open || opened.length >= 2) return;
      board[idx].open = true;
      opened.push(idx);
      renderBoard();
      if (opened.length === 2) {
        locked = true;
        let a = board[opened[0]].num, b = board[opened[1]].num;
        if (a === b) {
          setTimeout(() => {
            board[opened[0]].matched = true;
            board[opened[1]].matched = true;
            matchedCount++;
            opened = [];
            locked = false;
            renderBoard();
            if (matchedCount === numPairs) {
              memoryInfoDiv.textContent = "Поздравляем! Все пары найдены 🎉";
              restartBtn.style.display = '';
            }
          }, 500);
        } else {
          setTimeout(() => {
            board[opened[0]].open = false;
            board[opened[1]].open = false;
            opened = [];
            locked = false;
            renderBoard();
          }, 800);
        }
      }
    }
    function startMemoryGame() {
      newBoard();
      renderBoard();
      memoryInfoDiv.textContent = "Откройте два квадрата с одинаковым числом!";
      restartBtn.style.display = 'none';
    }
    restartBtn.onclick = startMemoryGame;
    // по умолчанию memory не показывается
    memoryWrap.style.display = 'none';
  </script>
</body>
</html>
