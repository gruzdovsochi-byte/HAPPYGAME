<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–£—á–∏–º—Å—è –∏ —Ä–∞–∑–≤–∏–≤–∞–µ–º—Å—è!</title>
  <style>
    body { background: #fffcd6; font-family: 'Comic Sans MS', Arial, Helvetica, sans-serif; margin:0; padding:0;}
    #game { text-align: center; margin-top: 40px; }
    #topbar { display: flex; gap: 16px; justify-content: center; align-items: center; flex-wrap: wrap; margin-bottom: 20px; }
    #modeLabel { font-size: 22px; color: #7346c8; }
    select { font-size: 20px; padding: 8px 12px; border-radius: 10px; border: 1px solid #bbb; }
    #score { font-size: 38px; font-weight: bold; margin-bottom: 16px; color: #FF5733; text-shadow: 1px 2px 6px #fffcd6; }
    #letter, #math { font-size: 90px; font-weight: bold; margin-bottom: 16px; transition: color 0.3s; text-shadow: 3px 5px 12px #ffcabb, 1px 2px 6px #fffcd6; letter-spacing: 8px; min-height: 110px; }
    #prompt { font-size: 32px; color: #7346c8; margin-bottom: 8px; min-height: 40px; }
    #result { font-size: 34px; margin-top: 18px; min-height: 45px; transition: color 0.3s; }
    #controls { margin-top: 28px; display: flex; gap: 16px; justify-content: center; align-items: center; flex-wrap: wrap; }
    #outputBtn { background: #CB6632; }
    button { padding: 16px 36px; font-size: 26px; background: #ff93c2; border: none; border-radius: 20px; box-shadow: 2px 4px 8px #919191; cursor: pointer; font-weight: bold; color: #fff; transition: background 0.3s, color 0.3s; }
    button:hover { background: #33fff0; color: #333; }
    #answerWrap { display: none; gap: 10px; justify-content: center; align-items: center; margin-top: 10px; flex-wrap: wrap; }
    #answerInput { font-size: 28px; padding: 10px 14px; width: 120px; text-align: center; border-radius: 12px; border: 1px solid #bbb; outline: none; }
    #checkBtn { background: #81d36b; }
    #statistics { margin: 32px auto 0 auto; background: #f7e2f7; border-radius: 14px; box-shadow: 1px 2px 8px #d9bade; padding: 28px 34px 18px 34px; width: fit-content; font-size: 22px; }
    #statistics h3 { margin: 0 0 8px 0; color: #8833d1; }
    #statistics table { margin: 0 auto; font-size: 22px; }
    #statistics td, #statistics th { padding: 0 14px; }
    /* --- –ù–∞–π–¥–∏ –ø–∞—Ä—É --- */
    #memory-wrap {display:none;}
    #game-board {
      margin: 0 auto;
      margin-top: 18px;
      margin-bottom: 18px;
      padding: 20px 0;
      display: grid;
      gap: 6px;
      width: max-content;
      justify-content: center;
      background: #ffeefd;
      border-radius: 15px;
      box-shadow: 0 3px 14px #cabeb6;
    }
    .cell {
      background: #ff93c2;
      border-radius: 9px;
      box-shadow: 1px 1px 5px #d0a6b4;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: transparent;
      font-weight: bold;
      transition: background 0.2s, color 0.2s;
      user-select: none;
      position: relative;
    }
    .cell.open {
      color: #452848;
      background: #f5ffa6;
      box-shadow: 0 2px 10px #a7b6d0;
    }
    .cell.matched {
      color: transparent;
      background: #fffcd6;
      cursor: default;
      box-shadow: none;
      visibility: hidden;
    }
    #memory-info {
      margin-top: 10px;
      font-size: 22px;
      color: #615c9c;
      min-height: 26px;
    }
    #restart-btn {
      margin-top: 10px;
      font-size: 20px;
      padding: 8px 26px;
      border-radius: 13px;
      background: #689cff;
      color: #fff;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 1px 2px 10px #9ec4f7;
      transition: background 0.25s;
      display: inline-block;
    }
    #restart-btn:hover { background: #33fff0; color: #333; }
    @media (max-width:650px) {
      #game-board {grid-template-columns: repeat(4, 12vw);}
      .cell{width:10vw; height:10vw; font-size:4vw;}
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="topbar">
      <span id="modeLabel">–†–µ–∂–∏–º:</span>
      <select id="mode">
        <option value="lettersRu">–†—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã</option>
        <option value="lettersEn">–ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã</option>
        <option value="math10">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (0‚Äì10)</option>
        <option value="math20">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (11‚Äì20)</option>
        <option value="math30">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (21‚Äì30)</option>
        <option value="memory4">–ù–∞–π–¥–∏ –ø–∞—Ä—É 4√ó4</option>
        <option value="memory6">–ù–∞–π–¥–∏ –ø–∞—Ä—É 6√ó6</option>
        <option value="memory8">–ù–∞–π–¥–∏ –ø–∞—Ä—É 8√ó8</option>
      </select>
    </div>
    <div id="score">–°—á–µ—Ç: 0.00 —Ä—É–±.</div>
    <h1 id="letter"></h1>
    <h1 id="math" style="display:none;"></h1>
    <p id="prompt">–ù–∞–∂–º–∏ —ç—Ç—É –±—É–∫–≤—É –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ!</p>
    <div id="answerWrap">
      <input id="answerInput" type="text" inputmode="numeric" autocomplete="off" placeholder="–û—Ç–≤–µ—Ç">
      <button id="checkBtn">–ü–†–û–í–ï–†–ò–¢–¨</button>
    </div>
    <div id="result"></div>
    <div id="controls">
      <button id="nextBtn">–°–õ–ï–î–£–Æ–©–ê–Ø</button>
      <button id="outputBtn">–í–´–í–ï–°–¢–ò –î–ï–ù–¨–ì–ò</button>
    </div>
    <div id="statistics"></div>
    <!-- –ù–∞–π–¥–∏ –ø–∞—Ä—É -->
    <div id="memory-wrap" style="display:none;">
      <div id="memory-info">–û—Ç–∫—Ä–æ–π—Ç–µ –¥–≤–∞ –∫–≤–∞–¥—Ä–∞—Ç–∞ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º —á–∏—Å–ª–æ–º!</div>
      <div id="game-board"></div>
      <button id="restart-btn">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    </div>
  </div>
  <script>
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è memory —Ä–µ–∂–∏–º–æ–≤
    let memoryStats = {
      memory4: 0,
      memory6: 0,
      memory8: 0
    };

    // –û–ë–´–ß–ù–´–ï –†–ï–ñ–ò–ú–´
    const lettersRu = [
      '–ê','–ë','–í','–ì','–î','–ï','–Å','–ñ','–ó','–ò','–ô','–ö','–õ','–ú','–ù','–û','–ü','–†',
      '–°','–¢','–£','–§','–•','–¶','–ß','–®','–©','–™','–´','–¨','–≠','–Æ','–Ø'
    ];
    const lettersEn = [
      'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M',
      'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'
    ];
    const colors = ["#FF5733", "#33FF57", "#3399FF", "#FBD400", "#FF33A1", "#B833FF", "#33FFF6", "#FF9966",
      "#81FF33", "#FFB533", "#33FFB5", "#FF3383", "#33CFFF", "#9D33FF", "#FFC300", "#FF5733",
      "#8DFF33", "#FF3380", "#338CFF", "#A133FF"
    ];
    const rewards = {
      lettersRu: 0.25,
      lettersEn: 0.30,
      math10: 0.5,
      math20: 0.75,
      math30: 1.0,
      memory4: 0.5,
      memory6: 0.75,
      memory8: 1.0
    };
    let stats = {
      balance: 0,
      lettersFoundRu: 0,
      lettersFoundEn: 0,
      math: { math10: 0, math20: 0, math30: 0 }
    };
    let mode = 'lettersRu';
    const modeSel = document.getElementById('mode');
    const scoreDiv = document.getElementById('score');
    const letterH1 = document.getElementById('letter');
    const mathH1 = document.getElementById('math');
    const promptP = document.getElementById('prompt');
    const resultDiv = document.getElementById('result');
    const nextBtn = document.getElementById('nextBtn');
    const outputBtn = document.getElementById('outputBtn');
    const answerWrap = document.getElementById('answerWrap');
    const answerInput = document.getElementById('answerInput');
    const checkBtn = document.getElementById('checkBtn');
    const statisticsDiv = document.getElementById('statistics');
    const memoryWrap = document.getElementById('memory-wrap');

    // ======= localStorage =======
    function getSavedStats() {
      const s = localStorage.getItem('mathletters_stats');
      if (s) {
        try {
          const parsed = JSON.parse(s);
          if (parsed && typeof parsed === "object") return {
            ...stats, ...parsed,
            math: { ...stats.math, ...parsed.math }
          };
        } catch {}
      }
      return stats;
    }
    function getSavedMemoryStats() {
      const s = localStorage.getItem('mathletters_memstats');
      if (s) {
        try {
          let obj = JSON.parse(s);
          if (obj.memory4 >= 0 && obj.memory6 >= 0 && obj.memory8 >= 0) return obj;
        } catch{}
      }
      return memoryStats;
    }
    function saveStats() { localStorage.setItem('mathletters_stats', JSON.stringify(stats)); }
    function saveMemoryStats() { localStorage.setItem('mathletters_memstats', JSON.stringify(memoryStats)); }

    // ======= –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ =======
    const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    function getRandomLetterRu() {
      return lettersRu[Math.floor(Math.random() * lettersRu.length)];
    }
    function getRandomLetterEn() {
      return lettersEn[Math.floor(Math.random() * lettersEn.length)];
    }
    const getRandomColor = () => colors[Math.floor(Math.random() * colors.length)];
    function updateScore() { scoreDiv.innerText = `–°—á–µ—Ç: ${stats.balance.toFixed(2)} —Ä—É–±.`; }
    function updateStatsTable() {
      statisticsDiv.innerHTML = `<h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
        <table>
          <tr><td>–†—É—Å—Å–∫–∏—Ö –±—É–∫–≤ –Ω–∞–π–¥–µ–Ω–æ:</td><td><b>${stats.lettersFoundRu}</b></td></tr>
          <tr><td>–ê–Ω–≥–ª–∏–π—Å–∫–∏—Ö –±—É–∫–≤ –Ω–∞–π–¥–µ–Ω–æ:</td><td><b>${stats.lettersFoundEn}</b></td></tr>
          <tr><th colspan="2" style="padding:8px 0 4px 0; color:#8B5CD0;">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</th></tr>
          <tr><td>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (0‚Äì10):</td><td><b>${stats.math.math10}</b></td></tr>
          <tr><td>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (11‚Äì20):</td><td><b>${stats.math.math20}</b></td></tr>
          <tr><td>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (21‚Äì30):</td><td><b>${stats.math.math30}</b></td></tr>
          <tr><th colspan="2" style="padding:8px 0 4px 0; color:#b567bb;">–ù–∞–π–¥–∏ –ø–∞—Ä—É</th></tr>
          <tr><td>–ü–∞—Ä—ã (4√ó4):</td><td><b>${memoryStats.memory4}</b></td></tr>
          <tr><td>–ü–∞—Ä—ã (6√ó6):</td><td><b>${memoryStats.memory6}</b></td></tr>
          <tr><td>–ü–∞—Ä—ã (8√ó8):</td><td><b>${memoryStats.memory8}</b></td></tr>
        </table>
        <div style="margin-top:10px;color:#CB6632;">–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <b>${stats.balance.toFixed(2)}</b> —Ä—É–±.</div>`;
    }
    function generateMathTask() {
      let min, max;
      if (mode === "math10") { min = 0;  max = 10; }
      if (mode === "math20") { min = 11; max = 20; }
      if (mode === "math30") { min = 21; max = 30; }
      op = Math.random() < 0.5 ? '+' : '-';
      if (op === '+') {
        let sum = rand(min, max);
        let a_tmp = rand(min, sum);
        let b_tmp = sum - a_tmp;
        a = a_tmp; b = b_tmp; answer = sum;
      } else {
        a = rand(min, max);
        b = rand(min, a);
        answer = a - b;
      }
      mathH1.innerText = `${a} ${op === '+' ? '+' : '‚àí'} ${b} = ?`;
      mathH1.style.color = getRandomColor();
      resultDiv.innerHTML = '';
      answerInput.value = '';
      setTimeout(() => answerInput.focus(), 0);
    }
    let currentLetter = null, a = 0, b = 0, op = '+', answer = 0;

    function switchToLettersRu() {
      letterH1.style.display = '';
      mathH1.style.display = 'none';
      answerWrap.style.display = 'none';
      promptP.style.display = '';
      resultDiv.style.display = '';
      nextBtn.style.display = '';
      outputBtn.style.display = '';
      statisticsDiv.style.display = '';
      memoryWrap.style.display = 'none';
      letterH1.innerText = getRandomLetterRu();
      letterH1.style.color = getRandomColor();
      promptP.innerText = '–ù–∞–∂–º–∏ —ç—Ç—É –±—É–∫–≤—É –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ!';
      resultDiv.innerHTML = '';
      answerInput.blur();
    }
    function switchToLettersEn() {
      letterH1.style.display = '';
      mathH1.style.display = 'none';
      answerWrap.style.display = 'none';
      promptP.style.display = '';
      resultDiv.style.display = '';
      nextBtn.style.display = '';
      outputBtn.style.display = '';
      statisticsDiv.style.display = '';
      memoryWrap.style.display = 'none';
      letterH1.innerText = getRandomLetterEn();
      letterH1.style.color = getRandomColor();
      promptP.innerText = 'Press this letter on the keyboard!';
      resultDiv.innerHTML = '';
      answerInput.blur();
    }
    function switchToMath() {
      letterH1.style.display = 'none';
      mathH1.style.display = '';
      answerWrap.style.display = 'flex';
      promptP.style.display = '';
      resultDiv.style.display = '';
      nextBtn.style.display = '';
      outputBtn.style.display = '';
      statisticsDiv.style.display = '';
      memoryWrap.style.display = 'none';
      promptP.innerText = '–†–µ—à–∏ –ø—Ä–∏–º–µ—Ä –∏ –≤–≤–µ–¥–∏ –æ—Ç–≤–µ—Ç:';
      generateMathTask();
    }
    function switchToMemory(fieldMode) {
      letterH1.style.display = 'none';
      mathH1.style.display = 'none';
      answerWrap.style.display = 'none';
      promptP.style.display = 'none';
      resultDiv.style.display = 'none';
      nextBtn.style.display = 'none';
      outputBtn.style.display = 'none';
      statisticsDiv.style.display = 'none';
      memoryWrap.style.display = 'block';
      startMemoryGame(fieldMode);
    }
    function checkMathAnswer() {
      const raw = answerInput.value.trim();
      const num = Number(raw);
      if (!Number.isInteger(num)) {
        resultDiv.innerHTML = `–í–≤–µ–¥–∏ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ!`;
        resultDiv.style.color = "#FF5733";
        return;
      }
      if (num === answer) {
        stats.balance = +(stats.balance + rewards[mode]).toFixed(2);
        stats.math[mode] = (stats.math[mode] || 0) + 1;
        saveStats();
        updateScore();
        updateStatsTable();
        resultDiv.innerHTML = `–ú–æ–ª–æ–¥–µ—Ü! <span style="color:#3399FF;">+${rewards[mode]} —Ä—É–±.</span> ‚ú®üòçüëç`;
        resultDiv.style.color = "#33FF57";
        setTimeout(() => { generateMathTask(); }, 700);
      } else {
        resultDiv.innerHTML = `–û–π! –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–µ ${num}. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë!`;
        resultDiv.style.color = "#FF5733";
      }
    }
    checkBtn.addEventListener('click', checkMathAnswer);
    answerInput.addEventListener('keydown', (e) => {
      const allowedKeys = ['Backspace','Delete','ArrowLeft','ArrowRight','Tab','Enter'];
      if (allowedKeys.includes(e.key)) {
        if (e.key === 'Enter') { e.preventDefault(); checkMathAnswer(); }
        return;
      }
      if (e.key >= '0' && e.key <= '9') {
        const sel = answerInput.selectionStart !== answerInput.selectionEnd;
        if (answerInput.value.length >= 2 && !sel) e.preventDefault();
        return;
      }
      e.preventDefault();
    });
    document.addEventListener('keydown', function(e) {
      if (modeSel.value === 'lettersRu') {
        let pressed = e.key.toUpperCase();
        let target = letterH1.innerText;
        if (pressed === target) {
          stats.balance = +(stats.balance + rewards.lettersRu).toFixed(2);
          stats.lettersFoundRu += 1;
          saveStats();
          updateScore();
          updateStatsTable();
          resultDiv.innerHTML = `–ú–æ–ª–æ–¥–µ—Ü! <span style="color:#3399FF;">+${rewards.lettersRu} —Ä—É–±.</span> ‚ú®üòçüëç`;
          resultDiv.style.color = "#33FF57";
          setTimeout(nextItem, 800);
        } else if (lettersRu.includes(pressed)) {
          resultDiv.innerHTML = `–û–π! –≠—Ç–æ –Ω–µ "${target}".`;
          resultDiv.style.color = "#FF5733";
        }
      } else if (modeSel.value === 'lettersEn') {
        let pressed = e.key.toUpperCase();
        let target = letterH1.innerText;
        if (pressed === target) {
          stats.balance = +(stats.balance + rewards.lettersEn).toFixed(2);
          stats.lettersFoundEn += 1;
          saveStats();
          updateScore();
          updateStatsTable();
          resultDiv.innerHTML = `Good job! <span style="color:#3399FF;">+${rewards.lettersEn} —Ä—É–±.</span> ‚ú®üòçüëç`;
          resultDiv.style.color = "#33FF57";
          setTimeout(nextItem, 800);
        } else if (lettersEn.includes(pressed)) {
          resultDiv.innerHTML = `Oops! It's not "${target}".`;
          resultDiv.style.color = "#FF5733";
        }
      }
    });
    function nextItem() {
      if (mode === 'lettersRu') {
        letterH1.innerText = getRandomLetterRu();
        letterH1.style.color = getRandomColor();
        resultDiv.innerHTML = "";
      } else if (mode === 'lettersEn') {
        letterH1.innerText = getRandomLetterEn();
        letterH1.style.color = getRandomColor();
        resultDiv.innerHTML = "";
      } else {
        generateMathTask();
      }
    }
    nextBtn.addEventListener('click', nextItem);
    outputBtn.addEventListener('click', () => {
      if (stats.balance > 0) {
        let oldBalance = stats.balance.toFixed(2);
        stats.balance = 0;
        saveStats();
        updateScore();
        updateStatsTable();
        alert(`–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!\n\n–¢—ã –≤—ã–≤–µ–ª ${oldBalance} —Ä—É–±.\n–¢–µ–ø–µ—Ä—å –º–æ–∂–µ—à—å –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –∏—Ö –∫–∞–∫ –∑–∞—Ö–æ—á–µ—à—å!`);
      } else {
        alert('–ü–æ–∫–∞ –Ω–µ—á–µ–≥–æ –≤—ã–≤–æ–¥–∏—Ç—å!\n–ó–∞—Ä–∞–±–æ—Ç–∞–π –µ—â–µ üòâ');
      }
    });

    // ====== –ù–ê–ô–î–ò –ü–ê–†–£ –†–ï–ñ–ò–ú–´ ======
    let board = [], opened = [], matchedCount = 0, locked = false, currentMemoryMode = "memory4";
    const boardDiv = document.getElementById('game-board');
    const memoryInfoDiv = document.getElementById('memory-info');
    const restartBtn = document.getElementById('restart-btn');
    function getBoardConf(mMode) {
      if (mMode==="memory4") return {size:4, pairs:8};
      if (mMode==="memory6") return {size:6, pairs:18};
      return {size:8, pairs:32};
    }
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    function newBoard(mMode) {
      let conf=getBoardConf(mMode);
      board = []; opened = []; matchedCount = 0; locked = false;
      let nums = [];
      for (let n = 1; n <= conf.pairs; n++) { nums.push(n); nums.push(n); }
      shuffle(nums);
      for (let i = 0; i < conf.size * conf.size; i++) {
        board.push({num: nums[i], open: false, matched: false});
      }
    }
    function renderBoard(mMode) {
      let conf=getBoardConf(mMode);
      boardDiv.innerHTML = '';
      boardDiv.style.gridTemplateColumns = `repeat(${conf.size}, 48px)`;
      boardDiv.style.gridTemplateRows = `repeat(${conf.size}, 48px)`;
      board.forEach((cell, idx) => {
        let div = document.createElement('div');
        div.className = 'cell';
        div.style.width="46px"; div.style.height="46px";
        if (cell.open) div.classList.add('open');
        if (cell.matched) div.classList.add('matched');
        div.textContent = cell.open || cell.matched ? cell.num : '';
        div.onclick = () => cellClicked(idx, mMode);
        boardDiv.appendChild(div);
      });
    }
    function cellClicked(idx, mMode) {
      if (locked || board[idx].matched || board[idx].open || opened.length >= 2) return;
      board[idx].open = true;
      opened.push(idx);
      renderBoard(mMode);
      if (opened.length === 2) {
        locked = true;
        let a = board[opened[0]].num, b = board[opened[1]].num;
        if (a === b) {
          setTimeout(() => {
            board[opened[0]].matched = true;
            board[opened[1]].matched = true;
            matchedCount++;
            stats.balance = +(stats.balance + rewards[mMode]).toFixed(2);
            memoryStats[mMode] += 1;
            saveStats(); saveMemoryStats();
            updateScore(); updateStatsTable();
            opened = [];
            locked = false;
            renderBoard(mMode);
            let conf=getBoardConf(mMode);
            if (matchedCount === conf.pairs) {
              memoryInfoDiv.textContent = "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—Å–µ –ø–∞—Ä—ã –Ω–∞–π–¥–µ–Ω—ã üéâ";
              restartBtn.style.display = '';
            }
          }, 500);
        } else {
          setTimeout(() => {
            board[opened[0]].open = false;
            board[opened[1]].open = false;
            opened = [];
            locked = false;
            renderBoard(mMode);
          }, 800);
        }
      }
    }
    function startMemoryGame(mMode) {
      currentMemoryMode = mMode;
      newBoard(mMode);
      renderBoard(mMode);
      memoryInfoDiv.textContent = "–û—Ç–∫—Ä–æ–π—Ç–µ –¥–≤–∞ –∫–≤–∞–¥—Ä–∞—Ç–∞ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º —á–∏—Å–ª–æ–º!";
      restartBtn.style.display = 'none';
    }
    restartBtn.onclick = function() { startMemoryGame(currentMemoryMode); };

    // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
    stats = getSavedStats();
    memoryStats = getSavedMemoryStats();
    updateScore();
    updateStatsTable();
    switchToLettersRu();

    modeSel.addEventListener('change', () => {
      mode = modeSel.value;
      if(mode==="lettersRu")      { switchToLettersRu(); }
      else if(mode==="lettersEn"){ switchToLettersEn(); }
      else if(mode==="math10"||mode==="math20"||mode==="math30") { switchToMath(); }
      else                       { switchToMemory(mode); }
    });

    memoryWrap.style.display = 'none';
  </script>
</body>
</html>
